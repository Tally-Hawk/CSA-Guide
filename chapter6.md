# مقدمه‌ای بر خط فرمان ویندوز

**پوسته فرمان داخلی CMD.exe و PowerShell** دو پیاده‌سازی هستند که در همه میزبان‌های ویندوز گنجانده شده‌اند. این ابزارها دسترسی مستقیم به سیستم عامل فراهم می‌کنند، وظایف روتین را خودکار می‌سازند و به کاربر کنترل دقیق بر هر جنبه‌ای از کامپیوتر و برنامه‌های نصب‌شده ارائه می‌دهند. این ماژول دانش، مهارت‌ها و توانایی‌های لازم برای مدیریت مؤثر میزبان‌های ویندوز از طریق خط فرمان را به ما می‌دهد.

از دیدگاه آزمایش نفوذ، ما یاد می‌گیریم چگونه از ابزارها و دستورات داخلی ویندوز و اسکریپت‌ها و برنامه‌های شخص ثالث برای کمک به شناسایی، بهره‌برداری و استخراج داده‌ها از محیط ویندوز استفاده کنیم، در حالی که به ماژول‌های پیشرفته‌تر پیش می‌رویم.

## پوسته فرمان(Command Prompt) در مقابل پاورشل

تفاوت‌های کلیدی بین **پوسته فرمان ویندوز** و **پاورشل** وجود دارد که در طول این ماژول مشاهده خواهیم کرد. یکی از تفاوت‌های کلیدی این است که می‌توانید دستورات پوسته فرمان را از کنسول پاورشل اجرا کنید، اما برای اجرای دستورات پاورشل از پوسته فرمان، باید دستور را با powershell پیشوند کنید (مانند powershell get-alias). جدول زیر برخی از تفاوت‌های کلیدی دیگر را نشان می‌دهد.

| **پاورشل** | **پوسته فرمان** |
|-------------|-------------------|
| **معرفی‌شده در سال ۲۰۰۶** | **معرفی‌شده در سال ۱۹۸۱** |
| **می‌تواند هم دستورات دسته‌ای و هم cmdletهای پاورشل را اجرا کند** | **فقط می‌تواند دستورات دسته‌ای را اجرا کند** |
| **پشتیبانی از استفاده از نام‌های مستعار دستورات** | **پشتیبانی از نام‌های مستعار دستورات ندارد** |
| **خروجی cmdlet می‌تواند به cmdletهای دیگر منتقل شود** | **خروجی دستورات نمی‌تواند به دستورات دیگر منتقل شود** |
| **همه خروجی‌ها به صورت شیء هستند** | **خروجی دستورات متن است** |
| **قادر به اجرای توالی cmdletها در یک اسکریپت** | **یک دستور باید قبل از اجرای دستور بعدی به پایان برسد** |
| **دارای محیط اسکریپت‌نویسی یکپارچه (ISE)** | **محیط ISE ندارد** |
| **می‌تواند به کتابخانه‌های برنامه‌نویسی دسترسی داشته باشد زیرا بر پایه چارچوب .NET ساخته شده است** | **نمی‌تواند به این کتابخانه‌ها دسترسی داشته باشد** |
| **می‌تواند روی سیستم‌های لینوکس اجرا شود** | **فقط روی سیستم‌های ویندوز قابل اجرا است** |

همان‌طور که می‌بینیم، **پوسته فرمان** روشی بسیار ایستا برای تعامل با سیستم عامل است، در حالی که **پاورشل** یک زبان اسکریپت‌نویسی قدرتمند است که می‌تواند برای طیف گسترده‌ای از وظایف استفاده شود و اسکریپت‌های ساده و بسیار پیچیده ایجاد کند.

# **مبانی خط فرمان (Command Prompt Basics)**

اولین گام برای ورود به دنیای حرفه‌ای خط فرمان ویندوز، آشنایی کامل با **cmd.exe** است. در این بخش سطح مبتدی (کمربند سفید!) را شروع می‌کنیم و با مفاهیم اولیه، نحوه دسترسی و عملکرد شل آشنا می‌شویم.

### **cmd.exe چیست؟**

**خط فرمان ویندوز** (که با نام‌های **cmd.exe** یا به اختصار **CMD** شناخته می‌شود) مفسر پیش‌فرض خط فرمان در تمام نسخه‌های ویندوز است. این ابزار از دوران **DOS** و دستور **COMMAND.COM** باقی مانده و هنوز هم در تمام سیستم‌های ویندوزی وجود دارد.

با یک دستور ساده در خط فرمان می‌توان کارهایی مانند تغییر رمز عبور، بررسی وضعیت کارت شبکه یا حتی اجرای اسکریپت‌های پیچیده را انجام داد. همچنین مصرف منابع آن بسیار کمتر از برنامه‌های گرافیکی است.

> نکته عملی: در بسیاری از تست‌های نفوذ، وقتی **PowerShell** به دلیل سیاست‌های AppLocker یا محدودیت‌های دیگر قفل شده بود، همچنان با استفاده از **cmd.exe** توانستم دسترسی بیشتر و ارتقای دسترسی (Privilege Escalation) را به دست آوردم.

### **نحوه دسترسی به خط فرمان**

#### **دسترسی محلی (Local Access)**
وقتی مستقیماً پشت سیستم یا ماشین مجازی نشسته‌اید:

- کلیدهای **Windows + R** → تایپ کنید `cmd` → Enter
- اجرای مستقیم فایل از مسیر:
  ```
  C:\Windows\System32\cmd.exe
  ```

#### **دسترسی از راه دور (Remote Access)**
وقتی از طریق شبکه به سیستم متصل می‌شوید (بدون حضور فیزیکی):

- پروتکل‌های رایج: RDP، PsExec، WinRM، SSH (در ویندوز ۱۰/۱۱)
- توجه امنیتی: اگر این ابزارها درست پیکربندی نشوند، مهاجم با یک جفت اعتبار معتبر می‌تواند به راحتی در کل شبکه حرکت کند.

### **استفاده اولیه**

ظاهر خط فرمان دهه‌هاست که تقریباً تغییر نکرده است. کار با آن مانند راه رفتن در راهروهای پر از در (پوشه‌ها) است.

#### **دستور مهم: dir**
```cmd
C:\Users\Arash\Desktop> dir
```

خروجی شامل:
- مسیر فعلی
- نام پوشه فعلی
- لیست فایل‌ها و پوشه‌ها با تاریخ و حجم

### **مطالعه موردی: بهره‌برداری از Windows Recovery**

در صورتی که کاربر از سیستم خارج شده یا مشکلی پیش آمده که ورود عادی ممکن نیست:

1. بوت از دیسک نصب ویندوز → **Repair your computer** → **Troubleshoot** → **Command Prompt**
2. در این حالت به خط فرمان با دسترسی بالا دست پیدا می‌کنید.
3. روش معروف **Sticky Keys Bypass** (مخصوصاً در ویندوز ۷ و قدیمی‌تر):

   - جایگزین کردن فایل `sethc.exe` (Sticky Keys) با `cmd.exe`
   - ری‌استارت سیستم
   - در صفحه لاگین، ۵ بار کلید **Shift** را فشار دهید → خط فرمان با دسترسی **NT AUTHORITY\SYSTEM** باز می‌شود!

   این روش نشان می‌دهد چرا حتی در سیستم‌های جدید هم باید قابلیت بوت از رسانه خارجی را محدود کرد.


این بخش مقدماتی بود. در بخش‌های بعدی با دستورات پرکاربرد، ریدایرکت‌ها، حلقه‌ها و تکنیک‌های پیشرفته‌تر خط فرمان ویندوز آشنا می‌شویم.
